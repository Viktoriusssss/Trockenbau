<Window x:Class="ModernWPFApp.Views.AufmassPositionEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:converters="clr-namespace:ModernWPFApp.Converters"
        Title="{Binding WindowTitle}"
        Height="700" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}">

    <Window.Resources>
        <converters:UnitConverter x:Key="UnitConverter"/>
        <converters:EuroConverter x:Key="EuroConverter"/>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{DynamicResource PrimaryHueLightBrush}"
                CornerRadius="4"
                Padding="16,12"
                Margin="0,0,0,16">
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="Ruler" 
                                       Width="24" 
                                       Height="24" 
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                <TextBlock Text="{Binding WindowTitle}" 
                          FontSize="18" 
                          FontWeight="Medium" 
                          VerticalAlignment="Center"
                          Margin="8,0,0,0"
                          Foreground="{DynamicResource PrimaryHueMidBrush}"/>
            </StackPanel>
        </Border>

        <!-- Form Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Column -->
                <StackPanel Grid.Column="0">
                    <!-- Position -->
                    <TextBox materialDesign:HintAssist.Hint="Position * (erforderlich)"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Position, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Beschreibung -->
                    <TextBox materialDesign:HintAssist.Hint="Beschreibung * (erforderlich)"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Beschreibung, UpdateSourceTrigger=PropertyChanged}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="80"
                             VerticalScrollBarVisibility="Auto"/>

                    <!-- Länge -->
                    <TextBox materialDesign:HintAssist.Hint="Länge"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Länge, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Breite -->
                    <TextBox materialDesign:HintAssist.Hint="Breite"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Breite, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Höhe -->
                    <TextBox materialDesign:HintAssist.Hint="Höhe"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Höhe, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- Right Column -->
                <StackPanel Grid.Column="2">
                    <!-- Std -->
                    <TextBox materialDesign:HintAssist.Hint="Std"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Std, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Stück -->
                    <TextBox materialDesign:HintAssist.Hint="Stück"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Stück, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Lfm -->
                    <TextBox materialDesign:HintAssist.Hint="Lfm"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Lfm, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Einzelpreis -->
                    <TextBox materialDesign:HintAssist.Hint="Einzelpreis (€)"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,16"
                             Text="{Binding Position.Einzelpreis, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Gesamt (Read-only display) -->
                    <Border Background="{DynamicResource MaterialDesignCardBackground}"
                            CornerRadius="4"
                            Padding="12,8"
                            Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock Text="Gesamt (berechnet)" FontWeight="Bold" FontSize="12" 
                                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            <TextBlock Text="{Binding Position.Gesamt, Converter={StaticResource EuroConverter}}" 
                                     FontSize="16" FontWeight="Medium"/>
                        </StackPanel>
                    </Border>

                    <!-- Gesamt Menge (Read-only display) -->
                    <Border Background="{DynamicResource MaterialDesignCardBackground}"
                            CornerRadius="4"
                            Padding="12,8"
                            Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock Text="Gesamt Menge (berechnet)" FontWeight="Bold" FontSize="12" 
                                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            <TextBlock Text="{Binding Position.GesamtMengeDisplay}" 
                                     FontSize="16" FontWeight="Medium"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Error Message -->
        <TextBlock Grid.Row="1" 
                   Text="{Binding ErrorMessage}"
                   Foreground="Red"
                   TextWrapping="Wrap"
                   Margin="0,0,0,16"
                   VerticalAlignment="Bottom"
                   Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,16,0,0">
            <Button Content="ABBRECHEN"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Command="{Binding CancelCommand}"
                    Margin="0,0,8,0"/>
            <Button Content="SPEICHERN"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Command="{Binding SaveCommand}"
                    IsEnabled="{Binding IsValid}"/>
        </StackPanel>
    </Grid>
</Window>


